<layout html head>
    <link href="https://cdn.bootcss.com/magnific-popup.js/1.1.0/magnific-popup.min.css" rel="stylesheet" />
    <script src="https://cdn.bootcss.com/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>

    <layout html ä¾§è¾¹æ >
        <layout html é¡¶æ >
            <div class="mdui-container">

                <div class="card">
                    <a href="./?mode=admin">
                        <p>åœ¨ç¾¤ä¸­@Botå¹¶å¸¦ä¸Šå›¾ç‰‡å°±å¯ä»¥æ˜¾ç¤ºåœ¨è¿™é‡Œäº†~<br>å¿«æ¥å±•ç¤ºä½ çš„å¾—æ„ä¹‹ä½œå§ğŸ•Šï¸<br>æ³¨æ„ï¼šè¯·ä¸è¦ä¸Šä¼ ä¸<strong>MINECRAFT,æœ¬æœåŠ¡å™¨æ— å…³</strong>çš„å›¾ç‰‡ã€‚</p>
                    </a>
                </div>
                <div class="mdui-card">

                    <div class="gallery-section">
                        <div class="inner-width">
                            <div class="gallery">
                            </div>
                        </div>
                    </div>
                    <div class="mdui-row">
                        <div class="mdui-col-xs-6">
                            <button class="mdui-btn mdui-btn-raised mdui-ripple" id="previous">ä¸Šä¸€é¡µ</button>
                        </div>
                        <div class="mdui-col-xs-6 mdui-text-right">
                            <button class="mdui-btn mdui-btn-raised mdui-ripple" id="next">ä¸‹ä¸€é¡µ</button>
                        </div>
                    </div>
                </div>


            </div>

            <script>
                $('.gallery').magnificPopup({
                    delegate: 'a',
                    type: 'image',
                    gallery: {
                        enabled: true
                    },
                    image: {
                        titleSrc: 'title' // æ˜¾ç¤ºé“¾æ¥çš„titleå±æ€§ä½œä¸ºå›¾ç‰‡åç§°
                    }
                })
                document.getElementById("titletext").innerHTML = "å³°é—´äº‘æµ·|ç›¸å†Œ";


                // è·å–URLä¸­çš„æŸ¥è¯¢å‚æ•°
                const urlParams = new URLSearchParams(window.location.search);

                // æ£€æŸ¥æ˜¯å¦å­˜åœ¨å‚æ•°num
                const num = urlParams.has('num') ? parseInt(urlParams.get('num')) : 0;
                if (num == 0) {
                    document.getElementById('previous').disabled = true;
                }
                fetch('https://mcweb-api.hzchu.top/user/photo?num=' + num)
                    .then(response => response.json())
                    .then(data => {
                        // å¤„ç†è¿”å›çš„æ•°æ®
                        const galleryDiv = document.querySelector('.gallery');
                        var count = data.length
                        console.log(count)
                        if (!count) {
                            document.getElementById('next').disabled = true;
                            mdui.snackbar({
                                message: 'çœ‹å®Œäº†ğŸ˜¢'
                            });
                            return
                        }
                        if (count < 24) {
                            document.getElementById('next').disabled = true;
                            mdui.snackbar({
                                message: 'æœ€åä¸€é¡µäº†ğŸ˜¶â€ğŸŒ«ï¸'
                            });
                        }
                        data.forEach(item => {
                            const {
                                author,
                                nickname,
                                id,
                                time,
                                url
                            } = item;
                            const title = `${id}_${nickname}_${author}_${time}`;

                            const aElement = document.createElement('a');
                            aElement.href = url;
                            aElement.className = 'image';
                            aElement.title = title;

                            const imgElement = document.createElement('img');
                            imgElement.src = url;
                            imgElement.alt = '';

                            aElement.appendChild(imgElement);
                            galleryDiv.appendChild(aElement);
                        });
                    })
                    .catch(error => {
                        mdui.snackbar({
                            message: 'å‘ç”Ÿé”™è¯¯:' + error
                        });
                        //console.error('å‘ç”Ÿé”™è¯¯:', error);
                    });

                // è·å–ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µæŒ‰é’®çš„å¼•ç”¨
                const previousButton = document.getElementById('previous');
                const nextButton = document.getElementById('next');

                // ç›‘å¬ä¸Šä¸€é¡µæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                previousButton.addEventListener('click', function() {
                    // å‡å»24
                    num_next = num - 24;

                    // å¦‚æœç»“æœå°äº0ï¼Œèµ‹å€¼ä¸º0
                    if (num_next < 0) {
                        num_next = 0;
                    }

                    // æ›´æ–°é¡µé¢å‚æ•°numçš„å€¼
                    updateUrlParameter('num', num_next);

                    // åˆ·æ–°é¡µé¢
                    window.location.reload();
                });

                // ç›‘å¬ä¸‹ä¸€é¡µæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                nextButton.addEventListener('click', function() {
                    num_next = num + 24;

                    // æ›´æ–°é¡µé¢å‚æ•°numçš„å€¼
                    updateUrlParameter('num', num_next);

                    // åˆ·æ–°é¡µé¢
                    window.location.reload();
                });

                // è·å–URLä¸­æŒ‡å®šå‚æ•°çš„å€¼
                function getParameterByName(name) {
                    const url = window.location.href;
                    name = name.replace(/[\[\]]/g, '\\$&');
                    const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
                    const results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, ' '));
                }

                // æ›´æ–°URLä¸­æŒ‡å®šå‚æ•°çš„å€¼
                function updateUrlParameter(key, value) {
                    const baseUrl = [location.protocol, '//', location.host, location.pathname].join('');
                    const urlQueryString = document.location.search;
                    const newParam = key + '=' + value;
                    let params = '?' + newParam;

                    // å¦‚æœURLä¸­å·²ç»åŒ…å«æŒ‡å®šå‚æ•°ï¼Œåˆ™æ›¿æ¢å®ƒçš„å€¼
                    if (urlQueryString) {
                        const keyRegex = new RegExp('([?&])' + key + '[^&]*');
                        if (urlQueryString.match(keyRegex) !== null) {
                            params = urlQueryString.replace(keyRegex, '$1' + newParam);
                        } else {
                            params = urlQueryString + '&' + newParam;
                        }
                    }

                    // æ›´æ–°URL
                    window.history.replaceState({}, '', baseUrl + params);
                }
            </script>
            <style>
                .gallery-section {
                    width: 100%;
                }
                
                .inner-width {
                    width: 100%;
                    max-width: 1200px;
                    margin: auto;
                }
                
                .gallery-section h1 {
                    text-align: center;
                    text-transform: uppercase;
                    color: #333;
                }
                
                .gallery-section .gallery {
                    display: flex;
                    flex-wrap: wrap;
                    justify-content: center;
                    padding: 10px;
                }
                
                .gallery-section .image {
                    flex: 25%;
                    overflow: hidden;
                    cursor: pointer;
                }
                
                .gallery-section .image img {
                    width: 100%;
                    height: 100%;
                    transition: 0.4s;
                }
                
                .gallery-section .image:hover img {
                    transform: scale(1.4) rotate(15deg);
                }
                
                @media screen and (max-width: 960px) {
                    .gallery-section .image {
                        flex: 33.33%;
                    }
                }
                
                @media screen and (max-width: 768px) {
                    .gallery-section .image {
                        flex: 50%;
                    }
                }
                
                @media screen and (max-width: 480px) {
                    .gallery-section .image {
                        flex: 100%;
                    }
                }
                
                .mdui-card {
                    width: 100%;
                    margin: 30px auto 0 auto;
                    border-radius: 10px;
                }
                
                .card {
                    margin: 30px auto 0 auto;
                    background-color: #fff;
                    border-radius: 5px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                    padding: 20px;
                    /* width: 85%; */
                }
                
                .card p {
                    font-size: 14px;
                    line-height: 1.5;
                    margin: 0;
                }
                
                .card a {
                    text-decoration: none;
                    color: inherit;
                }
                
                .mdui-row {
                    padding: 2%;
                }
            </style>
            <layout html footer>